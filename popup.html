<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Extension</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 380px;
            height: 500px;
            overflow: hidden;
        }

        .container {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .header .status {
            font-size: 12px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .message {
            margin-bottom: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            display: flex;
            justify-content: flex-end;
        }

        .message.bot {
            display: flex;
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-bubble {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 5px;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            max-width: 80px;
            margin-bottom: 15px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            padding: 5px;
            transition: border-color 0.3s ease;
        }

        .input-wrapper:focus-within {
            border-color: #667eea;
        }

        #user-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 12px 15px;
            background: transparent;
            font-size: 14px;
            color: #374151;
        }

        #user-input::placeholder {
            color: #9ca3af;
        }

        #send-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-size: 16px;
        }

        #send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        #send-btn:active {
            transform: scale(0.95);
        }

        #send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .welcome-message {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            margin-top: 40px;
            padding: 0 20px;
        }

        .welcome-message h3 {
            color: #374151;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            max-width: 80%;
            font-size: 14px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Chatbot</h1>
            <div class="status">
                <div class="status-dot"></div>
                <span>Online</span>
            </div>
        </div>

        <div class="chat-container" id="chatlog">
            <div class="welcome-message">
                <h3>ðŸ‘‹ Welcome!</h3>
                <p>I'm your AI assistant. How can I help you today?</p>
            </div>
        </div>

        <div class="typing-indicator" id="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>

        <div class="input-container">
            <div class="input-wrapper">
                <input id="user-input" type="text" placeholder="Type your message..." />
                <button id="send-btn" title="Send message">
                    <span>âž¤</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatlog = document.getElementById('chatlog');
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');

        // Auto-focus input when popup opens
        input.focus();

        function addMessage(content, isUser = false, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            if (isError) {
                messageDiv.innerHTML = `<div class="error-message">${content}</div>`;
            } else {
                messageDiv.innerHTML = `<div class="message-bubble">${content}</div>`;
            }
            
            // Remove welcome message if it exists
            const welcomeMsg = chatlog.querySelector('.welcome-message');
            if (welcomeMsg) {
                welcomeMsg.remove();
            }
            
            chatlog.appendChild(messageDiv);
            chatlog.scrollTop = chatlog.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            chatlog.scrollTop = chatlog.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        function setLoading(loading) {
            sendBtn.disabled = loading;
            if (loading) {
                sendBtn.innerHTML = '<span>âŸ³</span>';
                sendBtn.style.animation = 'spin 1s linear infinite';
            } else {
                sendBtn.innerHTML = '<span>âž¤</span>';
                sendBtn.style.animation = 'none';
            }
        }

        // Add spin animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        async function sendMessage() {
            const userMessage = input.value.trim();
            if (!userMessage || sendBtn.disabled) return;

            // Add user message
            addMessage(userMessage, true);
            input.value = '';
            
            // Show loading state
            setLoading(true);
            showTypingIndicator();

            try {
                // Replace this URL with your chatbot's API endpoint
                const response = await fetch('https://your-chatbot-api.example.com/message', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                        /*, 'Authorization': 'Bearer YOUR_API_KEY' */
                    },
                    body: JSON.stringify({ message: userMessage })
                });

                const data = await response.json();
                
                // Simulate some delay for better UX
                await new Promise(resolve => setTimeout(resolve, 500));
                
                hideTypingIndicator();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                // Show bot response (adjust field name depending on your API's response)
                const botReply = data.reply || data.response || 'Sorry, I couldn\'t generate a response.';
                addMessage(botReply);

            } catch (error) {
                hideTypingIndicator();
                console.error('Chat error:', error);
                
                let errorMessage = 'Unable to connect to the chatbot service. ';
                if (error.message.includes('fetch')) {
                    errorMessage += 'Please check your internet connection.';
                } else {
                    errorMessage += 'Please try again later.';
                }
                
                addMessage(errorMessage, false, true);
            } finally {
                setLoading(false);
                input.focus();
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize input based on content
        input.addEventListener('input', (e) => {
            // Optional: Add auto-resize functionality if needed
        });

        // Add some demo functionality for testing without API
        let demoMode = true; // Set to false when you have a real API

        if (demoMode) {
            // Override the sendMessage function for demo purposes
            const originalSendMessage = sendMessage;
            sendMessage = async function() {
                const userMessage = input.value.trim();
                if (!userMessage || sendBtn.disabled) return;

                addMessage(userMessage, true);
                input.value = '';
                setLoading(true);
                showTypingIndicator();

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));

                hideTypingIndicator();
                setLoading(false);

                // Generate demo responses
                const demoResponses = [
                    "That's an interesting question! I'm a demo chatbot, so I can't provide real AI responses yet.",
                    "Thanks for your message! Once you connect a real API, I'll be able to help you properly.",
                    "I understand what you're saying. This is just a demonstration of the chat interface.",
                    "Great! The UI is working perfectly. Now you just need to configure your actual chatbot API.",
                    "I'm impressed by this sleek interface! Ready to be connected to a real AI service."
                ];

                const randomResponse = demoResponses[Math.floor(Math.random() * demoResponses.length)];
                addMessage(randomResponse);
                input.focus();
            };
        }
    </script>
</body>
</html>